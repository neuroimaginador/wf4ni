<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Reproducible and Shareable Neuroimaging Pipelines: The <code>wf4ni</code> package • wf4ni</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Reproducible and Shareable Neuroimaging Pipelines: The &lt;code&gt;wf4ni&lt;/code&gt; package">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">wf4ni</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/wf4ni.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/rsfmri.html">Using `wf4ni` for Resting State fMRI processing</a>
    </li>
    <li>
      <a href="../articles/tractography.html">Using `wf4ni` to Compute Tractography</a>
    </li>
    <li>
      <a href="../articles/volumetry.html">Using `wf4ni` to Build a Volumetry Flow</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/neuroimaginador/wf4ni">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Reproducible and Shareable Neuroimaging Pipelines: The <code>wf4ni</code> package</h1>
                        <h4 class="author">Domingo López-Rodríguez</h4>
            
            <h4 class="date">2019-05-07</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/neuroimaginador/wf4ni/blob/master/vignettes/wf4ni.Rmd"><code>vignettes/wf4ni.Rmd</code></a></small>
      <div class="hidden name"><code>wf4ni.Rmd</code></div>

    </div>

    
    
<div id="the-wf4ni-package" class="section level1">
<h1 class="hasAnchor">
<a href="#the-wf4ni-package" class="anchor"></a>The <code>wf4ni</code> package</h1>
<p>There are a lot of packages in the R ecosystem focused on several aspects of Neuroimage processing, many of them listed in the <a href="https://CRAN.R-project.org/view=MedicalImaging">CRAN Task View: Medical Imaging</a> section: <code>oro.nifti</code>, <code>oro.dicom</code>, <code>RNifti</code>, <code>fmri</code>, <code>divest</code> (among others) for reading/writing of images; <code>ANTsR</code>, <code>fslr</code> for more advanced processing methods; <code>RNiftyReg</code> specialized in registration, <code>mritc</code> focused in image segmentation. Many more, for DTI, fMRI, molecular imaging, and visualization are available in <a href="https://CRAN.R-project.org">CRAN</a>.</p>
<p>However, to get a complete Neuroimaging pipeline working, it is common to rely on several different packages, and, in general, no single package can offer all the functionalities desired. Tracking the requirements and dependencies of a pipeline is time-consuming, since the user has to manually find, for each function used, the packages it depends on.</p>
<p>In addition, the most typical form of building a pipeline in R is via scripting. Once the needed functions are defined or imported from a third-party package, one or more scripts are written in order to get all processes done.</p>
<p>But scripts are error-prone, difficult to trace and debug if the script is large, and require some level of customization when one tries to run the script in a different environment (computer, laboratory…). These cons make us think of defining self-contained workflows, easily shareable, which can perform the same operations as a script but with greater legibility and traceability.</p>
<p>The goal of this package is to provide certain features to manage the situations before:</p>
<ul>
<li>
<strong>Simple definition of Neuroimaging flows</strong>, which can incorporate any <code>R</code> function (including those from other packages, such as <code>ANTsR</code> or <code>fslr</code>) as a part of it. At definition time, the package warns about inconsistencies on the flow from inputs to outputs (undefined functions or variables).</li>
<li>Creation of a <strong>common interface for the execution</strong> of Neuroimaging workflows, reducing the need of constantly looking up in the documentation of several packages. Instead of using a different syntax for each function, just <em>execute</em> the flow, specifying the required outputs, and all associated functions are run in the right order to get the results.</li>
<li>Ability to <strong>automatically track dependencies</strong>. Every time a new function or process is inserted into a flow, the <em>flow</em> object tries to guess its dependencies, by looking up in the different loaded namespaces, and storing (internally) this information to be used in the export stage.</li>
<li>
<strong>Workflows can be shared</strong> across multiple systems. A <em>flow</em> object can be exported and saved as a regular .zip file, and then reloaded in a different computer. When importing a flow, the package detects (from in internals) if there are missing dependencies (packages not installed on the system) and prompts the user to install them.</li>
<li>
<strong>Extensibility</strong>. A node in the workflow is a single function in <code>R</code>, that is, something that can be computed in runtime. This means that a process in the pipeline can be, for example, a function to generate a plot, or to compute image statistics, or a function that wraps a random forest which has been previously trained to infer a labelling on the input image. The <code>wf4ni</code> package provides the tools to extend this functionality to other <em>computations</em>: machine learning or deep learning models, for instance.</li>
<li>
<strong>Simple memory management</strong>. The memory used by intermediate outputs when running a flow is automatically released when those outputs are no longer needed for further results, thus keeping the memory footprint as small as possible.</li>
<li>Work natively with <strong>NIfTI files</strong>.</li>
</ul>
<div id="requirements" class="section level2">
<h2 class="hasAnchor">
<a href="#requirements" class="anchor"></a>Requirements</h2>
<p>The following packages are imported by <code>wf4ni</code>:</p>
<blockquote>
<p>stringr, styler, devtools, igraph, RCurl, R6, RNifti, neurobase, oro.nifti, scales, zip, crayon, prettyunits, pryr, purrr, methods, utils</p>
</blockquote>
<p>Please, install them before attempting the installation of <code>wf4ni</code>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">install.packages</span>(<span class="kw">c</span>(<span class="st">"stringr"</span>, <span class="st">"styler"</span>, <span class="st">"devtools"</span>, <span class="st">"igraph"</span>, <span class="st">"RCurl"</span>,</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">                   <span class="st">"R6"</span>, <span class="st">"RNifti"</span>, <span class="st">"neurobase"</span>, <span class="st">"oro.nifti"</span>, <span class="st">"scales"</span>,</a>
<a class="sourceLine" id="cb1-3" data-line-number="3">                   <span class="st">"zip"</span>, <span class="st">"crayon"</span>, <span class="st">"prettyunits"</span>, <span class="st">"pryr"</span>, <span class="st">"purrr"</span>))</a></code></pre></div>
</div>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>Currently, this package is not in CRAN. The only way to get this package installed is by using the <code>remotes</code> package and installing <code>wf4ni</code> from GitHub:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">remotes<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/remotes/topics/install_github">install_github</a></span>(<span class="st">"neuroimaginador/wf4ni"</span>)</a></code></pre></div>
</div>
<div id="the-wf4ni-model" class="section level2">
<h2 class="hasAnchor">
<a href="#the-wf4ni-model" class="anchor"></a>The <code>wf4ni</code> model</h2>
<p>In <code>wf4ni</code>, a <em>flow</em> is an ordered collection of processes that convert inputs into outputs, such that the output of a process may be the input to another one.</p>
<p>By defining the appropriate functions, one can model the pipeline in the correct order and obtain a flow as the one depicted in the following figure:</p>
<p><img src="wf4ni_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<p>Original inputs in the <em>flow</em> are <em>I1</em>, <em>I2</em> and <em>I3</em> (in green). Other nodes represent the output of a given function, using the incident nodes as inputs for that function.</p>
<p>A <em>flow</em> object stores information about the functions used and their relationships, building what is called a <em>computation graph</em>.</p>
</div>
<div id="examples" class="section level2">
<h2 class="hasAnchor">
<a href="#examples" class="anchor"></a>Examples</h2>
<p>A simple example:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">library</span>(wf4ni)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"></a>
<a class="sourceLine" id="cb3-3" data-line-number="3">f &lt;-<span class="st"> </span><span class="cf">function</span>(a, b) {a <span class="op">+</span><span class="st"> </span>b}</a>
<a class="sourceLine" id="cb3-4" data-line-number="4"></a>
<a class="sourceLine" id="cb3-5" data-line-number="5">my_flow &lt;-<span class="st"> </span>NIflow<span class="op">$</span><span class="kw">new</span>(<span class="dt">name =</span> <span class="st">"test"</span>, <span class="dt">inputs =</span> <span class="kw">c</span>(<span class="st">"I1"</span>, <span class="st">"I2"</span>))</a>
<a class="sourceLine" id="cb3-6" data-line-number="6"></a>
<a class="sourceLine" id="cb3-7" data-line-number="7">my_flow<span class="op">$</span><span class="kw"><a href="../reference/add.html">add</a></span>(<span class="dt">what =</span> f, <span class="dt">inputs =</span> <span class="kw">c</span>(<span class="st">"I1"</span>, <span class="st">"I2"</span>), <span class="dt">output =</span> <span class="st">"O1"</span>)</a>
<a class="sourceLine" id="cb3-8" data-line-number="8">my_flow<span class="op">$</span><span class="kw"><a href="../reference/add.html">add</a></span>(<span class="dt">inputs =</span> <span class="st">"I3"</span>)</a>
<a class="sourceLine" id="cb3-9" data-line-number="9">my_flow<span class="op">$</span><span class="kw"><a href="../reference/add.html">add</a></span>(<span class="dt">what =</span> f, <span class="dt">inputs =</span> <span class="kw">c</span>(<span class="st">"I2"</span>, <span class="st">"I3"</span>), <span class="dt">output =</span> <span class="st">"O2"</span>)</a>
<a class="sourceLine" id="cb3-10" data-line-number="10">my_flow<span class="op">$</span><span class="kw"><a href="../reference/add.html">add</a></span>(<span class="dt">what =</span> f, <span class="dt">inputs =</span> <span class="kw">c</span>(<span class="st">"O1"</span>, <span class="st">"I3"</span>), <span class="dt">output =</span> <span class="st">"O3"</span>)</a>
<a class="sourceLine" id="cb3-11" data-line-number="11">my_flow<span class="op">$</span><span class="kw"><a href="../reference/add.html">add</a></span>(<span class="dt">what =</span> f, <span class="dt">inputs =</span> <span class="kw">c</span>(<span class="st">"O3"</span>, <span class="st">"I3"</span>), <span class="dt">output =</span> <span class="st">"O4"</span>)</a>
<a class="sourceLine" id="cb3-12" data-line-number="12"></a>
<a class="sourceLine" id="cb3-13" data-line-number="13">my_flow<span class="op">$</span><span class="kw"><a href="../reference/plot.html">plot</a></span>()</a></code></pre></div>
<p>This flow produces the pipeline shown in the figure above. It is not retricted to NIfTI images, as the function <em>f</em> used to define some of the outputs is not designed specifically for Neuroimaging (it is just the sum of its two arguments).</p>
<p>By using</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">my_flow<span class="op">$</span><span class="kw"><a href="../reference/execute.html">execute</a></span>(<span class="dt">inputs =</span> <span class="kw">list</span>(<span class="dt">I1 =</span> <span class="dv">3</span>, <span class="dt">I2 =</span> <span class="dv">2</span>), <span class="dt">desired_outputs =</span> <span class="kw">c</span>(<span class="st">"O1"</span>))</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"></a>
<a class="sourceLine" id="cb4-3" data-line-number="3">my_flow<span class="op">$</span><span class="kw"><a href="../reference/execute.html">execute</a></span>(<span class="dt">inputs =</span> <span class="kw">list</span>(<span class="dt">I1 =</span> <span class="dv">3</span>, <span class="dt">I2 =</span> <span class="dv">2</span>, <span class="dt">I3 =</span> <span class="dv">4</span>), </a>
<a class="sourceLine" id="cb4-4" data-line-number="4">                <span class="dt">desired_outputs =</span> <span class="kw">c</span>(<span class="st">"O1"</span>, <span class="st">"O2"</span>, <span class="st">"O4"</span>))</a></code></pre></div>
<p>we obtain, in the first case, a list with just one field named “O1” whose value corresponds to the application of the workflow up to the required output. In the second case, the list contains fields “O1”, “O2” and “O4”, with the corresponding values.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="op">&gt;</span><span class="st"> </span>my_flow<span class="op">$</span><span class="kw"><a href="../reference/execute.html">execute</a></span>(<span class="dt">inputs =</span> <span class="kw">list</span>(<span class="dt">I1 =</span> <span class="dv">3</span>, <span class="dt">I2 =</span> <span class="dv">2</span>), <span class="dt">desired_outputs =</span> <span class="kw">c</span>(<span class="st">"O1"</span>))</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="op">$</span>O1</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">[<span class="dv">1</span>] <span class="dv">5</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="op">&gt;</span><span class="st"> </span>my_flow<span class="op">$</span><span class="kw"><a href="../reference/execute.html">execute</a></span>(<span class="dt">inputs =</span> <span class="kw">list</span>(<span class="dt">I1 =</span> <span class="dv">3</span>, <span class="dt">I2 =</span> <span class="dv">2</span>, <span class="dt">I3 =</span> <span class="dv">4</span>), </a>
<a class="sourceLine" id="cb5-6" data-line-number="6">                  <span class="dt">desired_outputs =</span> <span class="kw">c</span>(<span class="st">"O1"</span>, <span class="st">"O2"</span>, <span class="st">"O4"</span>))</a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="op">$</span>O1</a>
<a class="sourceLine" id="cb5-8" data-line-number="8">[<span class="dv">1</span>] <span class="dv">5</span></a>
<a class="sourceLine" id="cb5-9" data-line-number="9"></a>
<a class="sourceLine" id="cb5-10" data-line-number="10"><span class="op">$</span>O2</a>
<a class="sourceLine" id="cb5-11" data-line-number="11">[<span class="dv">1</span>] <span class="dv">6</span></a>
<a class="sourceLine" id="cb5-12" data-line-number="12"></a>
<a class="sourceLine" id="cb5-13" data-line-number="13"><span class="op">$</span>O4</a>
<a class="sourceLine" id="cb5-14" data-line-number="14">[<span class="dv">1</span>] <span class="dv">13</span></a></code></pre></div>
<p>More advanced examples, with applications to common pipelines in Neuroimaging, are in the vignettes of this package.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#the-wf4ni-package">The <code>wf4ni</code> package</a><ul class="nav nav-pills nav-stacked">
<li><a href="#requirements">Requirements</a></li>
      <li><a href="#installation">Installation</a></li>
      <li><a href="#the-wf4ni-model">The <code>wf4ni</code> model</a></li>
      <li><a href="#examples">Examples</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Domingo Lopez-Rodriguez.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
